{% extends "base.html" %}
{% load staticfiles %}

{% block top_html %}
  <html ng-app="analyticsApp" itemscope itemtype="http://schema.org/Article">
  <!-- ^ Google Server-Side App Sign In-->
{% endblock %}

{% block content %}
<div class="cal-home-logged-out">
  <div class="jumbotron cal-main-display">
    <h1>CalendarAnalytics</h1>
    <h3 class="cal-description">Analyze how much time you spend in meetings or with a friend using your Calendar.</h3>
    <button id="google-plus-button" class="cal-signin-button">Sign In With Google</button>
  </div>

  <div class="jumbotron cal-main-display">
    <h2>Still aren't convinced?</h2>
    <p class="cal-description">CalendarAnalytics is a way for you to analyze how much time you spend.</p>
  </div>


</div>
{% endblock %}

{% block bottom_js %}
  {{ block.super }}
  <!-- BEGIN PSA G+ signin-->
  <script type="text/javascript">
    gapi.load('auth2', function () {
      var auth2;
      auth2 = gapi.auth2.init({
        client_id: "{{ social_auth_google_plus_key }}",
        scope: "{{ social_auth_google_oauth2_scope | safe }}",
      });
      auth2.then(function () {
        var button = document.getElementById("google-plus-button");
        console.log("User is signed-in in Google+ platform?", auth2.isSignedIn.get() ? "Yes" : "No");

        auth2.attachClickHandler(button, {}, function (googleUser) {
          // Send access-token to backend to finish the authenticate
          // with your application

          var authResponse = googleUser.getAuthResponse();
          var $form;
          var $input;

          $form = $("<form>");
          $form.attr("action", "/complete/google-plus/");
          $form.attr("method", "post");
          $input = $("<input>");
          $input.attr("name", "access_token");
          $input.attr("value", authResponse.access_token);
          $form.append($input);
          // Add csrf-token if needed
          $(document.body).append($form);
          $form.submit();
        });
      });
    });
  </script>
  <!-- END PSA G+ signin-->
{% endblock %}
